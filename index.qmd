---
title: "Greenspace Exposure and Park Access in Erie County, NY"
author: Jingyu Wu
date: today
date-format: long
---

# Introduction

Green spaces mitigate environmental exposures and contribute to healthier neighborhood environments, while public parks offer accessible opportunities for recreation, social interaction, and physical activity. Yet, the presence of vegetation and the accessibility of parks do not always align spatially. Some neighborhoods may have abundant street-level vegetation but be far from formal park entrances; others may be adjacent to parks yet lack greenness along residential streets. This study examines neighborhood streetscapes in Erie County, New York, to address two key questions: How is local greenness, measured by the Normalized Difference Vegetation Index (NDVI), related to park accessibility? Where do mismatches or disparities occur?

The project proceeds in three steps: (1) calculating mean NDVI within a 300-meter buffer around each census block group centroid as an indicator of everyday greenspace exposure; (2) using OpenStreetMap data to compute network-based distances to the nearest park entrance as a measure of accessibility; and (3) exploring spatial and demographic patterns associated with both indicators. These analyses establish a foundation for subsequent statistical modeling and equity-focused assessment of greenspace and park access in the county.

# Materials and methods

I first used the tidycensus and tigris packages to download 2023 American Community Survey block group data for Erie County, including total population and polygon geometries. The dataset was cleaned to retain GEOID, population, and geometry, assigned a unique block group ID, and reprojected it.

To measure everyday greenspace exposure, I loaded a 2024 mean NDVI GeoTIFF for Erie County (MODIS) using the raster package and projected it to match the block group CRS. For each block group, I created a point-on-surface centroid, buffered it by 300m, and used *exactextractr* to compute the mean NDVI within each buffer. These values were joined back to the block group table as ndvi_mean300.

Park accessibility was derived from OpenStreetMap using *osmdata*. I downloaded park polygons and entrance points. When explicit entrances were absent, park centroids were used as proxies. Both entrances and block group centroids were transformed to WGS84, and *sf* was used to compute the minimum distance from each block group to the nearest entrance. This produced a continuous distance variable, a 300 m accessibility indicator, and an accessibility score for later mapping and analysis.

```{r, message=F, warning=F}
library(tidycensus)
library(tigris)
library(sf)
library(sp)
library(raster)
library(exactextractr)
library(tidyverse)
library(osmdata)
library(dodgr)
library(classInt)
library(ggplot2)
library(plotly)
```

## Download and clean all required data

```{r, message=F, warning=F}
# Erie County block groups
census_api_key("695c0ea3ada22e99f85eb2200fd51a7d00469573", install = TRUE, overwrite = TRUE)
readRenviron("~/.Renviron")

acs_year <- 2023

bg <- get_acs(
  geography = "block group",
  variables = c(POP = "B01003_001"),
  state = "NY",
  county = "Erie",
  year = acs_year,
  geometry = TRUE,
  output = "wide") |>
  transmute(GEOID, POP = POPE, geometry) |>
  st_make_valid() |>
  mutate(bg_id = row_number())

bg <- st_transform(bg, 26918)



```

```{r,message=F, warning=F}
# NDVI （300m ）
ndvi <- raster("data/ndvi_erie_2024_mean.tif")
ndvi <- projectRaster(ndvi, crs = st_crs(bg)$wkt)

centroids <- st_point_on_surface(bg)
buffers   <- st_buffer(centroids, 300) |> st_make_valid()
buffers   <- buffers[st_is(buffers, "POLYGON"), ]

vals <- exact_extract(ndvi, buffers, "mean")

bg <- bg |>
  left_join(
    tibble(bg_id = buffers$bg_id, ndvi_mean300 = vals),
    by = "bg_id" )
```

```{r,message=F, warning=F,cache=TRUE}
#accessible ----
bg_ll <- st_transform(bg, 4326)
bbox  <- st_bbox(bg_ll)

# park
parks_osm <- opq(bbox = bbox) |>
  add_osm_feature(key = "leisure", value = "park") |>
  osmdata_sf()
parks_poly <- parks_osm$osm_polygons |>
  st_make_valid()
# entrance
entrance_osm <- opq(bbox = bbox) |>
  add_osm_feature(key = "entrance") |>
  osmdata_sf()

entrances <- entrance_osm$osm_points
```

```{r,message=F, warning=F,cache=TRUE}


if (nrow(entrances) == 0) {
  entrances <- st_centroid(st_transform(parks_poly, 4326))} else {
  entrances <- st_transform(entrances, 4326)}

cent_ll <- st_geometry(bg_ll)

#distance caculate
dist_mat <- st_distance(cent_ll, st_geometry(entrances))
min_dist <- apply(dist_mat, 1, min)

bg$dist_to_park_m <- as.numeric(min_dist)
bg$access_300m    <- bg$dist_to_park_m <= 300
bg$access_score   <- -bg$dist_to_park_m
```

Add any additional processing steps here.

# Results

Research findings indicate significant spatial disparities in green space access and park accessibility within Erie County. The first map categorises residential areas based on proximity to park entrances within 300 metres. Park accessibility is predominantly concentrated in downtown Buffalo and several suburban zones, while extensive areas in the county's south and east remain beyond walking distance to any park. The second map displays average NDVI values within 300-metre buffers, revealing lower vegetation cover in densely built-up urban centres and higher NDVI values in suburban areas.

To synthesise these two dimensions, a bivariate map categorises each block group by NDVI (low/medium/high) and park accessibility (low/medium/high) quantiles. Multiple census tracts surrounding urban parks in Buffalo exhibit high accessibility but low greenness (LM/LM), indicating limited street-level vegetation despite physical proximity to parks. Conversely, numerous rural areas feature high NDVI values yet extremely low accessibility (high green/high accessible), meaning residents enjoy abundant vegetation but remain distant from formal parks.

A scatter plot of NDVI against accessibility scores further confirms their weak correlation. NDVI values cluster within the 0.20–0.60 range, while accessibility scores exhibit significant variation. This indicates that greenness and proximity to parks function as distinct environmental exposure factors rather than redundant indicators.

```{r, message=F, warning=F,fig.width=6, fig.height=3, fig.cap="Map of completely random data"}
ndvi_breaks <- classIntervals(bg$ndvi_mean300, n = 3, style = "quantile")$brks
access_breaks <- classIntervals(bg$access_score, n = 3, style = "quantile")$brks

bg$exp_cat <- cut(bg$ndvi_mean300,
                  breaks = ndvi_breaks,
                  labels = c("Low", "Med", "High"),
                  include.lowest = TRUE)

bg$acc_cat <- cut(bg$access_score,
                  breaks = access_breaks,
                  labels = c("Low", "Med", "High"),
                  include.lowest = TRUE)

bg <- bg |>
  mutate(bi_class = paste0(substr(exp_cat, 1, 1),
                           substr(acc_cat, 1, 1)))

biv_palette <- c(
  "LL" = "#e8e8e8",
  "ML" = "#ace4e4",
  "HL" = "#5ac8c8",
  "LM" = "#dfb0d6",
  "MM" = "#a5add3",
  "HM" = "#5698b9",
  "LH" = "#be64ac",
  "MH" = "#8c62aa",
  "HH" = "#3b4994")

bg$bi_class <- factor(bg$bi_class, levels = names(biv_palette))

```

```{r, message=F, warning=F}

# NDVI Exposure Map
ggplot(bg) + geom_sf(aes(fill = ndvi_mean300), color = "grey40", size = 0.1) +
scale_fill_gradient(name = "Mean NDVI\n(300 m buffer)",
low  = "white", high = "darkgreen", na.value = "grey90") +
labs(title = "Greenspace Exposure (NDVI)\nErie County, NY") +
theme_minimal()

# Park Accessibility
bg$access_300m_factor <- factor(bg$access_300m,levels = c(FALSE, TRUE),
labels = c("Not within 300 m", "Within 300 m"))

ggplot(bg) +geom_sf(aes(fill = access_300m_factor), color = "grey40", size = 0.1) +
scale_fill_manual(values = c("grey80", "darkgreen"), name = "Park Access") +
labs(title = "Park Accessibility (≤ 300 m)\nErie County, NY") +
theme_minimal()

# Greenspace Exposure × Access
ggplot(bg) + geom_sf(aes(fill = bi_class), color = "grey40", size = 0.1) +
scale_fill_manual(values = biv_palette, name = "Exposure × Access") +
labs(title = "Greenspace Exposure × Access\nErie County, NY") +
theme_minimal()

# Scatter-like Centroid Marker Map
df_plot <- bg |> st_drop_geometry()

p_scatter <- ggplot(df_plot, aes(
  x    = ndvi_mean300,
  y    = access_score,
  size = POP)) +
  geom_point(alpha = 0.4) +
  scale_size_continuous(name = "Population") +
  labs(
    x = "Mean NDVI (300 m buffer)",
    y = "Access score (shorter distance = higher)",
    title = "Greenspace Exposure vs. Access") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

ggplotly(p_scatter)

#csv
priority_table <- df_plot |>
  mutate( priority_group = case_when(
      exp_cat == "High" & acc_cat == "Low"  ~ "High exposure / Low access",
      exp_cat == "Low"  & acc_cat == "Low"  ~ "Low exposure / Low access",
      exp_cat == "Low"  & acc_cat == "High" ~ "Low exposure / High access",
      exp_cat == "High" & acc_cat == "High" ~ "High exposure / High access",
      TRUE ~ "Other" )) |>
  group_by(priority_group) |>
  summarise( n_bg      = n(),total_pop = sum(POP, na.rm = TRUE),.groups   = "drop" )
print(priority_table)

```

# Conclusions

This project demonstrates that greenspace exposure and park accessibility represent distinct spatial dimensions of environmental quality in Erie County. Although many neighborhoods in Buffalo lie within short walking distance of a park entrance, they often exhibit relatively low NDVI values, indicating limited everyday vegetation along streets and residential areas. Conversely, outlying suburban and rural tracts tend to have high greenness but poor access to formal parks, reflecting a different type of mismatch between environmental amenities. This study provides a foundation for future work focused on equity, health, and policy implications. The methods can be extended to examine which populations live in low-greenness or low-access areas, evaluate disparities across income or race, and support targeted investments in street trees, park entrances, and green infrastructure to improve environmental conditions across the county.

# References

Lu, Y., Han, S. S., & Bush, J. (2025). *More parks, more justice? Unpacking distributional and recognitional justice in Shanghai’s urban greening policies*. *Urban Forestry & Urban Greening*.

Kabisch, N., & Haase, D. (2014). Green justice or just green? Provision of urban green spaces in Berlin, Germany. *Landscape and Urban Planning, 122*, 129–139.

Boeing, G. (2017). OSMnx: New methods for acquiring, constructing, analyzing, and visualizing complex street networks. *Computers, Environment and Urban Systems, 65*, 126–139.

Twohig-Bennett, C., & Jones, A. (2018). The health benefits of the great outdoors: A systematic review and meta-analysis of greenspace exposure and health outcomes. *Environmental Research, 166*, 628–637.

Comber, A., Brunsdon, C., & Green, E. (2008). Using a GIS-based network analysis to determine urban greenspace accessibility for different ethnic and religious groups. *Landscape and Urban Planning, 86*(1), 103–114.

Rigolon, A. (2016). A complex landscape of inequity in access to urban parks: A literature review. *Landscape and Urban Planning, 153*, 160–169.
